<!DOCTYPE html>
<html lang="ja">

<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="format-detection" content="telephone=no,address=no,email=no">
	<title>TEST</title>
</head>

<body>
	<script src="../dist/ink-0.0.6.js"></script>

	<script>
		// 	var worker = new Worker('worker.js');
		// 	worker.addEventListener("message", (params) => {
		// 		console.log(params.data);
		// 	}, false);
		// worker.postMessage("postMessage");

	let connectedGamepadIndex;
	let loopID;


	console.log("navigator.getGamepads()", navigator.getGamepads());
	// ゲームパッドの接続
	window.addEventListener("gamepadconnected", function (e) {
		console.log("navigator.getGamepads()", navigator.getGamepads());
		connectedGamepadIndex = e.gamepad.index;
		loopID = requestAnimationFrame(loop);
	});

	// ゲームパッドの切断
	window.addEventListener("gamepaddisconnected", function (e) {
		console.log("Gamepad disconnected");
		connectedGamepadIndex = null;
		cancelAnimationFrame(loopID);
	});

		const BUTTON_A_INDEX = 0;

		const BUTTON_B_INDEX = 1;
		const BUTTON_X_INDEX = 2;
		const BUTTON_Y_INDEX = 3;
		const BUTTON_LB_INDEX = 4;
		const BUTTON_RB_INDEX = 5;
		const BUTTON_LT_INDEX = 6;
		const BUTTON_RT_INDEX = 7;
		const BUTTON_BACK_INDEX = 8;
		const BUTTON_START_INDEX = 9;
		const BUTTON_L3_INDEX = 10;
		const BUTTON_R3_INDEX = 11;
		const BUTTON_UP_INDEX = 12;
		const BUTTON_DOWN_INDEX = 13;
		const BUTTON_LEFT_INDEX = 14;
		const BUTTON_RIGHT_INDEX = 15;
		const BUTTON_HOME_INDEX = 16;

	function loop(timestamp) {
		// ゲームパッドの入力情報を毎フレーム取得します。
		let gamepads = navigator.getGamepads();
		let gp = gamepads[connectedGamepadIndex];

		console.log(gp);

		// ボタンが押されているかどうかを取得します。
		// let aButton = gp.buttons[BUTTON_A_INDEX];
		// if (aButton.pressed) {
		// 	console.log(`Aボタンが押されました。value:${aButton.value}`);
		// }

		loopID = requestAnimationFrame(loop);
	}



		console.log("INK.Deferred.serial");

		function a(params) {
			let def = new INK.Deferred();
			// console.log("ここでエラー");
			// console.log(hoge);
			setTimeout(() => {
				console.log("a");
				def.resolve("val a");
			}, 500);
			return def.promise;
		}

		function b(params) {
			let def = new INK.Deferred();
			// console.log("ここでエラー");
			// console.log(hoge);
			setTimeout(() => {
				console.log("b start");
				console.log("b");
				def.resolve("val b");
				// def.reject("val b");
			}, 500);
			return def.promise;
		}

		function c(params) {
			let def = new INK.Deferred();

			setTimeout(() => {
				// console.log("ここでエラー");
				// console.log(hoge);
				console.log("c");
				def.resolve("val c");
			}, 500);
			return def.promise;
		}

		// INK.Deferred.serial(
		// 	function (params) {
		// 		console.log("START");
		// 		return 1;
		// 	},
		// 	c,
		// 	(v)=>{
		// 		console.log("===1===");
		// 		console.log("//////");
		// 		console.log(v);
		// 		console.log("//////");

		// 		return INK.Deferred.parallel(a, b, c);
		// 		// return c();
		// 	},
		// 	(v) => {
		// 		console.log("===2===");
		// 		console.log("//////");
		// 		console.log(v);
		// 		console.log("//////");
		// 		return INK.Deferred.serial(a, c, b);
		// 	},
		// 	(v)=>{
		// 		console.log("===3===");
		// 		console.log("//////");
		// 		console.log(a);
		// 		console.log("//////");
		// 		console.log("!!!!!!!!!!!!!!!!!!");
		// 	}
		// );

			function sampleResolve(value) {
				return new Promise(resolve => {
					// console.log(hoge);
					setTimeout(() => {
						console.log("sampleResolve");
						resolve(value * 2);
					}, 2000);
				})
			}



			/**
			 * sampleResolve()をawaitしているため、Promiseの結果が返されるまで処理が一時停止される
			 * 今回の場合、2秒後にresolve(10)が返ってきてその後の処理（return result + 5;）が再開される
			 * resultにはresolveされた10が格納されているため、result + 5 = 15がreturnされる
			 */
			// async function sample() {
			// 	await INK.Deferred.delay(5000);
			// 	await INK.Deferred.serial(a, c, b);
			// 	await INK.Deferred.serial(a, c, b);
			// }

			// INK.Deferred.serial(a, b, c);
				// INK.Deferred.parallel(a, b, sampleResolve)






	</script>


</body>

</html>
